# CMDB系统 TODO

## 数据库模型和数据持久化
- [ ] 创建用户表模型
- [ ] 创建角色表模型
- [ ] 创建权限表模型
- [ ] 创建权限组表模型
- [ ] 创建用户-角色关联表
- [ ] 创建角色-权限关联表
- [ ] 创建权限组-资源关联表
- [ ] 实现数据库查询辅助函数
- [ ] 实现tRPC API路由
- [ ] 集成WebSocket实时推送
- [ ] 更新前端页面使用新API

## UI优化和移动端支持
- [x] 重新设计权限管理页面展示关联关系
- [ ] 优化用户管理页面展示用户关联
- [x] 添加移动端响应式布局
- [x] 优化导航栏移动端显示
- [ ] 优化表格移动端显示

## 权限管理优化
- [x] 权限分配改为多选列表+Tag形式
- [x] Mock数据实时更新支持
- [x] 修复移动端权限列表卡片变形
- [x] 完善权限列表详细信息展示
- [ ] 添加预设权限模板

## 权限完善
- [x] 添加完整的CRUD权限（创建、读取、更新、删除）
- [x] 为每个资源类型添加完整权限集

## 权限组功能完善
- [x] 添加权限组用户管理（添加/移除用户）
- [x] 添加权限组资源管理（添加/移除资源）
- [x] 弹窗改为移动端抽屉式风格
- [x] 优化权限组详情展示

## 方案B权限组资源管理实现
- [x] 优化PC端布局，增加内容区域宽度
- [x] 添加用户选择列表（替代手动输入ID）
- [x] 添加资源选择列表（替代手动输入ID）
- [ ] 实现权限组资源创建逻辑（普通用户必须选择权限组）
- [ ] 实现资源访问权限检查（管理员访问所有，普通用户访问权限组资源）
- [ ] 更新资源列表显示逻辑

## 抽屉弹窗优化
- [x] 修复抽屉弹窗默认高度过小的问题
- [x] 优化抽屉弹窗在PC端的显示效果

## 权限分配优化
- [x] 显示已分配的权限（Tag标签形式）
- [x] 改为输入框+下拉选择（带模糊搜索）
- [x] 已分配权限在下拉列表中高亮显示
- [x] 支持点击Tag删除已分配的权限

## Bug修复
- [x] 修复权限管理页面roles.map错误（数据格式问题）

## 权限分配UI优化
- [x] 实现Ant Design风格的多选输入框（输入框内显示Tag标签）
- [x] 点击输入框弹出下拉列表
- [x] 支持搜索过滤权限
- [x] 点击Tag的X删除已选权限

## 多选下拉组件实现
- [x] 创建多选下拉组件（输入框内显示Tag标签）
- [x] 点击输入框弹出带复选框的下拉面板
- [x] 支持搜索过滤下拉列表
- [x] 修复添加权限功能（点击复选框添加权限）

## 多选下拉组件Bug修复
- [x] 修复无法选中权限的问题（mockData返回数据格式不一致）
- [x] 修复无法添加权限到角色的问题
- [x] 检查API调用和事件处理逻辑

## 创建权限表单优化
- [x] 将资源类型和操作类型合并到同一行
- [x] 固定选择框宽度提升美观度

## 权限组添加用户功能优化
- [x] 为权限组添加用户功能使用多选下拉组件
- [x] 保持权限组卡片样式不变
- [x] 添加removeUserFromGroup API方法

## 权限组批量操作功能
- [x] 添加"批量操作"按钮到权限组卡片
- [x] 实现从其他权限组复制资源功能
- [x] 实现按资源类型批量添加功能
- [x] 实现资源迁移功能（复制+删除）
- [x] 实现批量移除资源功能
- [x] 添加批量操作相关API方法

## 添加资源界面优化
- [x] 将资源类型和选择框合并到同一行
- [x] 固定选择框宽度
- [x] 将资源列表从卡片式改为表格式
- [x] 添加分页功能

## 添加资源界面修复和改进
- [x] 修复资源类型和选择框布局（真正放在同一行）
- [x] 添加搜索框支持关键字搜索
- [x] 改进分页组件为页码按钮式（1 2 3 4 5 ... 50）
- [x] 添加每页条数选择器（10条/页）

## 修复表单布局
- [x] 将资源类型和搜索框真正放在同一行（不换行）
- [x] 移除搜索框的Label，直接紧贴在选择框后面

## 修复Label布局
- [x] 将Label、选择框、搜索框都放在同一行（不换行）

## 资源多选功能
- [x] 将"选择"按钮改为复选框
- [x] 支持多选资源
- [x] 添加批量添加到权限组功能

## 资源数量显示优化
- [x] 修复添加资源后数量不更新的bug
- [x] 优化资源数显示为总数（如"资源: 6个"）
- [x] 添加鼠标悬浮提示显示详细分类（如"3个域名, 2个Nginx配置, 1个脚本"）

## 资源数显示和全选功能
- [x] 修复资源数显示格式（显示纯数字，不带"个"）
- [x] 添加表格标题行全选复选框
- [x] 实现全选/取消全选逻辑

## 多标签页管理功能
- [x] 创建标签页管理组件
- [x] 实现标签页打开、切换、关闭功能
- [x] 实现固定标签（首页不能关闭）
- [x] 集成到主布局中
- [x] 点击侧边栏菜单自动创建/切换标签

## 仪表盘链接修复
- [x] 修复多标签页点击仪表盘标签后404问题（使用wouter的setLocation替代window.history.pushState）

## 标签页增强功能
- [x] 限制标签页数量为10个
- [x] 实现标签状态持久化（localStorage）
- [x] 实现标签拖拽排序功能（使用dnd-kit）

## 标签页点击问题修复
- [x] 修复标签页无法点击切换的问题（将拖拽监听器只应用到标签文本）
- [x] 修复标签页无法关闭的问题（关闭按钮不受拖拽监听器影响）

## 标签切换和WebSocket问题修复
- [x] 修复标签无法切换的问题（使用onPointerDown代替on Click）
- [x] 修复用户列表WebSocket消息循环问题（禁用Mock WebSocket自动消息）

## 标签拖拽功能修复
- [x] 修复标签无法拖拽移动的问题（恢复onClick，让dnd-kit自动区分点击和拖拽）
- [x] 保持点击切换功能正常工作

## 标签点击切换修复
- [x] 使用activationConstraint区分点击和拖拽（设置8px阈值）
- [x] 确保点击切换和拖拽排序都能正常工作

## 权限管理页面样式修复
- [x] 优化权限组卡片布局（右侧空白问题）
- [x] 改为响应式布局（sm:2列 xl:3列 2xl:4列）

## 角色和权限列表布局优化

- [x] 优化角色列表布局（右侧空白问题）
- [x] 优化权限列表布局（右侧空白问题）
- [x] 统一使用响应式grid布局（sm:2列 xl:3列 2xl:4列）

## 响应式布局断点优化
- [x] 优化角色和权限列表响应式断点（将xl改为lg，让卡片在中等屏幕宽度下更好填充空间）

## 卡片布局优化
- [x] 修改卡片布局为固定宽度自适应列数，让卡片保持合理宽度不随屏幕拉宽而变宽（250px-310px）

## 移除移动端响应式适配
- [x] 移除Layout组件中的移动端自动折叠功能（保留PC端手动折叠）
- [x] 移除所有页面中的sm:, md:等小屏幕断点
- [x] 保留当前卡片布局风格，后续单独开发移动端APP

## 标签页重复问题修复
- [x] 修复点击侧边栏菜单时重复创建仪表板标签的问题（统一使用dashboard作ID）

## 侧边栏菜单结构扩展
- [x] 创建占位页面组件（域名管理、网站管理、系统设置模块）
- [x] 更新Layout组件支持多级子菜单展开/折叠
- [x] 配置路由映射所有新增页面
- [x] 域名管理模块：域名列表、解析模版、账号分组、证书管理
- [x] 网站管理模块：网站列表、DNS配置、解析线路、节点列表、节点分组、华为CDN、回源列表
- [x] 系统设置模块：用户管理、权限设置、密钥配置

## 菜单展开状态保持
- [x] 修复点击子菜单后父菜单自动折叠的问题（添加固定id字段，持久化展开状态到localStorage）

## 域名管理Web页面实现（仅前端，后端由Go实现）
- [x] 设计数据库表结构（供Go后端参考）
- [x] 实现账号分组管理页面（Mock数据）
- [x] 实现域名列表页面（Mock数据）
- [x] 实现手动添加域名功能（前端交互）
- [x] 实现NS配置指引弹窗（前端展示）
- [x] 在代码中注释需要对接的Go API接口

## 域名管理功能增强
- [x] 实现批量导入域名功能（支持CSV/Excel上传）
- [x] 优化指定账户同步功能（每个账号独立同步按钮 + 域名列表下拉选择）
- [x] 创建域名解析管理页面（A/AAAA/CNAME/MX/TXT/NS/SRV记录CRUD）
- [x] 实现修改注册商NS功能（仅自动同步域名可用）
- [x] 添加页面访问控制（NS未生效的域名无法管理解析）

## 域名解析管理页面优化
- [x] 处理域名过长显示问题（省略号+Tooltip悬停显示完整内容）
- [x] 实现批量导入解析记录功能（CSV/Excel上传）
- [x] 实现双击表格行进入行内编辑模式
- [x] 实现行内添加记录（表格顶部插入空行，不使用弹窗）
- [x] 添加WebSocket实时更新逻辑（代码中注释实现方案）

## 解析列表页面功能优化
- [x] 实现连续添加记录功能（保存并继续添加按钮）
- [x] 添加解析内容复制按钮（一键复制并显示复制成功状态）
- [x] 修改TTL为固定选项（1分钟/5分钟/10分钟/30分钟/1小时/2小时/1天）
- [x] 添加分页功能（每页10/20/50条，首页/上一页/下一页/末页）

## 连续添加记录功能优化
- [x] 修改添加记录逻辑，支持连续点击"添加记录"按钮插入多条空行
- [x] 允许同时编辑多条新记录，每条记录独立保存或取消

## 域名解析管理页面体验优化
- [x] 添加删除确认对话框，防止误删
- [x] 修复进入解析页面时的加载闪烁问题（添加loading状态显示）
- [x] 实现记录值验证（A记录只能输入IPv4，AAAA记录只能输入IPv6，CNAME/MX/NS只能输入域名）
- [x] 优化表格列宽（类型列100px，名称和值列增加px-6，TTL/优先级/代理状态/操作列固定宽度）

## 域名列表页面优化
- [x] 移除列表中的过期时间和NS状态列
- [x] 添加展开按钮查看域名详细信息（包含过期时间、NS状态、NS记录）
- [x] 状态列仅显示Cloudflare域名状态（活跃/暂停/待激活），非Cloudflare域名显示"-"

## 域名列表布局调整
- [x] 将来源字段从表格主列表移到展开区域显示
- [x] 域名列设置固定宽度280px（增加40px）
- [x] 调整表格列数为6列，修改colSpan值为6

## 全局页面布局优化
- [x] 移除所有页面容器的左右内边距（paddingLeft和paddingRight设置为0px）
- [x] 保持上下内边距以维持合理的垂直间距
- [x] 已修改页面：DomainList、DomainRecords、AccountGroup（其他页面使用space-y-6布局无需修改）

## 域名列表展开区域布局优化
- [x] 将标签和值在同一行显示（来源和过期时间在同一行，使用gap-6分隔）
- [x] 将NS状态和NS记录整合在NS信息区域，垂直排列
- [x] 优化展开区域的信息层次（减少padding，调整间距，统一Badge尺寸）

## 域名列表展开区域布局调整和功能增强
- [x] 调整布局顺序：NS信息（状态+记录）放第一行，来源和过期时间放第二行
- [x] NS状态和NS记录在同一行显示，使用gap-4分隔
- [x] 为每个NS记录Badge添加点击复制功能，显示复制成功提示

## 域名列表展开区域美观度和交互优化
- [x] 增加展开区域的间距（py-4、space-y-3、px-6、gap-6），让布局更舒适
- [x] 为NS记录Badge添加复制图标（Copy图标），提示用户可以点击复制
- [x] 将“检测NS”按钮从主列表移到折叠内容第二行右侧

## NS记录样式和折叠区域布局优化
- [x] NS记录使用虚线边框样式（border-2 border-dashed），字体更大（text-sm），增加padding
- [x] 实现点击复制后图标从Copy变成Check（✓），2秒后自动恢复，使用状态管理
- [x] 调整折叠区域为2列网格布局，左右数据上下对齐，NS记录单独一行

## 折叠区域布局调整
- [x] NS状态和NS记录保持在同一行显示，使用gap-6分隔
- [x] 过期时间和来源放在第二行显示，检测NS按钮在右侧
- [x] NS记录改为Badge样式（variant="outline"），与NS状态保持一致，保留复制功能

## 折叠区域布局重新调整
- [x] 第一行三等分：NS状态、来源、过期时间（使用grid grid-cols-3 gap-6）
- [x] 第二行：NS记录单独占满整行，使用flex-1自适应宽度
- [x] 检测NS按钮放在NS记录行右侧，使用ml-auto对齐

## 折叠区域布局比例调整
- [x] 第一行改为2:2:4比例（使用grid-cols-8，NS状态col-span-2、来源col-span-2、过期时间col-span-4）
- [x] 第二行NS记录占5份（col-span-5），检测NS按钮占3份（col-span-3）
- [x] NS状态为active时，检测NS按钮设置为disabled状态，无法点击

## 域名列表功能增强
- [x] 移除折叠区域的检测NS按钮
- [x] 在NS记录行添加“修改NS”按钮，点击显示开发中提示
- [x] 调整第二行布局，NS记录占满整行，使用flex-1自适应
- [x] 添加域名列表多选功能（每行添加checkbox）
- [x] 添加全选/取消全选功能（表头checkbox）
- [x] 显示已选中域名数量和批量操作按钮（取消选择、批量删除）

## 移除列表操作列的修改NS按钮
- [x] 从列表操作列移除“修改NS”按钮（移除条件显示的修改NS按钮）
- [x] 只保留折叠区域的修改NS按钮（已在NS记录行显示）

## 修改NS按钮状态逻辑优化
- [x] 修改NS按钮根据DNS服务商判断是否可用（disabled={domain.dnsProvider === 'Cloudflare'}）
- [x] Cloudflare等DNS服务商禁用修改NS按钮，显示提示“Cloudflare为DNS服务商，无法修改NS记录”
- [x] 只有注册商（如GoDaddy）才启用修改NS按钮，显示提示“修改注册商NS记录”

## 区分域名注册商和DNS服务商
- [x] 添加registrar字段表示域名注册商（如GoDaddy、阿里云域名）
- [x] dnsProvider字段表示DNS服务商（如Cloudflare、阿里云DNS）
- [x] 修改NS按钮根据registrar是否存在来判断是否disabled
- [x] 修改NS按钮不再依赖nsRecords是否存在，始终显示
- [x] 调整折叠区域布局：第一行NS状态/来源/过期时间，第二行注册商+修改NS按钮，第三行NS记录（如果有）

## 添加canModifyNS字段优化显示逻辑
- [x] 添加canModifyNS字段（boolean），由后端判断是否可以修改NS
- [x] 当canModifyNS=true时，显示注册商和修改NS按钮（第三行）
- [x] 当canModifyNS=false时，不显示注册商和修改NS按钮
- [x] 调整折叠区域布局顺序：第一行NS状态/来源/过期时间，第二行NS记录（如果有），第三行注册商+修改NS按钮（仅canModifyNS=true时显示）

## 修复管理解析页面白屏问题
- [x] 排查点击“管理解析”按钮后的路由跳转逻辑
- [x] 将window.location.href改为使用wouter的setLocation进行SPA路由跳转
- [x] 修复白屏问题，实现平滑跳转

## 合并批量导入和手动添加功能
- [x] 移除“批量导入”相关状态和函数（isBatchImportDialogOpen、uploadFile、handleBatchImport）
- [x] 将“手动添加”按钮改名为“添加域名”
- [x] 修改“添加域名”对话框，将Input改为textarea支持多行输入
- [x] 添加域名格式验证（正则表达式）
- [x] 支持批量添加最多1000个域名（每行一个）
- [x] 添加详细的错误提示（格式不正确、数量超限等）

## 域名解析管理功能优化
- [x] 移除NS状态限制，允许任何状态的域名进入解析管理页面（方便查看历史记录）
- [x] 实现动态路由，将路由从/domain/records改为/domain/:domainName/records
- [x] 修改DomainRecords页面支持从路由参数读取域名信息
- [x] 更新App.tsx路由配置支持动态参数

## 网站列表页面实现
- [x] 设计网站数据结构（域名、CNAME、线路组、权限组、状态）
- [x] 创建Mock数据用于前端展示（5条测试数据）
- [x] 实现网站列表表格UI（包含所有字段列）
- [x] 实现编辑功能（弹窗表单，支持新增和编辑）
- [x] 实现删除功能（确认对话框）
- [x] 实现缓存清理功能（确认对话框）
- [x] 添加搜索功能（支持域名、CNAME、线路组、权限组搜索）
- [x] 添加域名格式验证
- [x] 在代码中注释需要对接的Go API接口和WebSocket实时更新

## 网站列表页面优化
- [x] 域名列改为定宽280px，支持多个域名显示，超长内容截断+鼠标悬停显示
- [x] CNAME列改为定宽300px，超长内容截断+鼠标悬停显示
- [x] 添加SSL状态列（在CNAME后面，显示有效/已过期/未配置）
- [x] 修改编辑操作，从弹窗改为跳转到新页面
- [x] 创建网站编辑页面（/website/:id/edit和/website/new）
- [x] 更新路由配置支持网站编辑页面
- [x] 编辑页面支持多行输入域名（每行一个）

## 网站列表表格布局优化
- [x] CNAME列宽度缩小（从300px改为200px），字体缩小（使用text-xs）
- [x] 调整列顺序：域名 → 状态 → CNAME → SSL状态 → 线路组 → 权限组 → 操作
- [x] 压缩操作列（宽度200px），使用更小的按钮（h-8 px-2）和间距（gap-1）
- [x] 缩短按钮文字（“缓存清理”改为“缓存”）

## 网站列表和编辑功能优化
- [x] 在表格第一列添加多选框，支持批量选择网站
- [x] 添加全选/取消全选功能（表头复选框）
- [x] 显示已选择数量
- [x] 修改添加/编辑网站表单：移除CNAME字段
- [x] 添加回源地址字段：支持手动输入IP或选择回源列表（RadioGroup切换）
- [x] 修改删除确认：从Dialog弹窗改为浏览器原生confirm
- [x] 修改缓存清理确认：从Dialog弹窗改为浏览器原生confirm
- [x] 表格列名修改：CNAME改为回源地址
- [x] 回源地址显示优化：IP直接显示，回源列表显示“回源列表 #ID”

## 网站列表显示修正
- [x] 修改Website接口：同时包含cname和回源地址字段（originType、originValue）
- [x] 更新Mock数据：为每个网站添加cname字段
- [x] 修改表格显示：同时显示CNAME列和回源地址列
- [x] 表单保持不变：不需要输入CNAME（由系统自动生成），只需配置回源地址
- [x] 表格列顺序：多选框 → 域名 → 状态 → CNAME → 回源地址 → SSL状态 → 线路组 → 权限组 → 操作
- [x] 回源地址显示优化：IP直接显示，回源列表显示“列表#ID”

## 网站列表UI优化
- [x] 移除权限组列，调整表格布局
- [x] 实现CNAME点击复制功能（点击CNAME直接复制到剪贴板，显示toast提示）
- [x] 进一步缩小操作按钮尺寸（h-7 px-1.5 text-xs）
- [x] 实现内联删除确认：点击删除后在该行显示“确认删除”和“取消”按钮，不使用弹窗或confirm
- [x] 缓存清理保持confirm确认方式
- [x] CNAME列宽度调整为200px，鼠标悬停显示“点击复制”提示
- [x] 操作列宽度调整为160px，按钮间距缩小为gap-0.5

## 删除确认方式修改
- [x] 将删除确认从内联按钮改为Popover气泡确认
- [x] 点击删除按钮后显示Popover气泡，包含确认消息和“确认删除”、“取消”按钮
- [x] 移除deletingId状态管理
- [x] 使用PopoverTrigger包裹按钮，点击后自动关闭Popover

## 删除确认气泡样式优化
- [x] 修改Popover样式为带警告图标的简洁风格
- [x] 左侧添加橙色圆形警告图标（AlertCircle，背景色bg-orange-100）
- [x] 简化标题文字，使用“确定删除网站？”
- [x] 按钮样式：取消（outline）、OK（primary蓝色）
- [x] 优化布局：图标和文字横向排列，按钮在底部右对齐

## Popover定位修复
- [x] 添加side属性，设置气泡弹出位置（side="top"）
- [x] 添加align属性，设置气泡对齐方式（align="center"）
- [x] 确保气泡固定在删除按钮上方弹出，不会到处移动

## Popconfirm组件开发（类似Ant Design）
- [ ] 创建 Popconfirm 组件文件（@/components/ui/popconfirm.tsx）
- [ ] 基于 Radix UI Popover 封装 Popconfirm 组件
- [ ] 实现 title、description、onConfirm、onCancel 属性
- [ ] 实现 open 和 setOpen 状态管理
- [ ] 添加警告图标和按钮样式
- [ ] 在 WebsiteList 中使用 Popconfirm 替换 Popover
- [ ] 测试删除确认功能是否正常工作
