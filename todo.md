# CMDB系统 TODO

## 数据库模型和数据持久化
- [ ] 创建用户表模型
- [ ] 创建角色表模型
- [ ] 创建权限表模型
- [ ] 创建权限组表模型
- [ ] 创建用户-角色关联表
- [ ] 创建角色-权限关联表
- [ ] 创建权限组-资源关联表
- [ ] 实现数据库查询辅助函数
- [ ] 实现tRPC API路由
- [ ] 集成WebSocket实时推送
- [ ] 更新前端页面使用新API

## UI优化和移动端支持
- [x] 重新设计权限管理页面展示关联关系
- [ ] 优化用户管理页面展示用户关联
- [x] 添加移动端响应式布局
- [x] 优化导航栏移动端显示
- [ ] 优化表格移动端显示

## 权限管理优化
- [x] 权限分配改为多选列表+Tag形式
- [x] Mock数据实时更新支持
- [x] 修复移动端权限列表卡片变形
- [x] 完善权限列表详细信息展示
- [ ] 添加预设权限模板

## 权限完善
- [x] 添加完整的CRUD权限（创建、读取、更新、删除）
- [x] 为每个资源类型添加完整权限集

## 权限组功能完善
- [x] 添加权限组用户管理（添加/移除用户）
- [x] 添加权限组资源管理（添加/移除资源）
- [x] 弹窗改为移动端抽屉式风格
- [x] 优化权限组详情展示

## 方案B权限组资源管理实现
- [x] 优化PC端布局，增加内容区域宽度
- [x] 添加用户选择列表（替代手动输入ID）
- [x] 添加资源选择列表（替代手动输入ID）
- [ ] 实现权限组资源创建逻辑（普通用户必须选择权限组）
- [ ] 实现资源访问权限检查（管理员访问所有，普通用户访问权限组资源）
- [ ] 更新资源列表显示逻辑

## 抽屉弹窗优化
- [x] 修复抽屉弹窗默认高度过小的问题
- [x] 优化抽屉弹窗在PC端的显示效果

## 权限分配优化
- [x] 显示已分配的权限（Tag标签形式）
- [x] 改为输入框+下拉选择（带模糊搜索）
- [x] 已分配权限在下拉列表中高亮显示
- [x] 支持点击Tag删除已分配的权限

## Bug修复
- [x] 修复权限管理页面roles.map错误（数据格式问题）

## 权限分配UI优化
- [x] 实现Ant Design风格的多选输入框（输入框内显示Tag标签）
- [x] 点击输入框弹出下拉列表
- [x] 支持搜索过滤权限
- [x] 点击Tag的X删除已选权限

## 多选下拉组件实现
- [x] 创建多选下拉组件（输入框内显示Tag标签）
- [x] 点击输入框弹出带复选框的下拉面板
- [x] 支持搜索过滤下拉列表
- [x] 修复添加权限功能（点击复选框添加权限）

## 多选下拉组件Bug修复
- [x] 修复无法选中权限的问题（mockData返回数据格式不一致）
- [x] 修复无法添加权限到角色的问题
- [x] 检查API调用和事件处理逻辑

## 创建权限表单优化
- [x] 将资源类型和操作类型合并到同一行
- [x] 固定选择框宽度提升美观度

## 权限组添加用户功能优化
- [x] 为权限组添加用户功能使用多选下拉组件
- [x] 保持权限组卡片样式不变
- [x] 添加removeUserFromGroup API方法

## 权限组批量操作功能
- [x] 添加“批量操作”按钮到权限组卡片
- [x] 实现从其他权限组复制资源功能
- [x] 实现按资源类型批量添加功能
- [x] 实现资源迁移功能（复制+删除）
- [x] 实现批量移除资源功能
- [x] 添加批量操作相关API方法

## 添加资源界面优化
- [x] 将资源类型和选择框合并到同一行
- [x] 固定选择框宽度
- [x] 将资源列表从卡片式改为表格式
- [x] 添加分页功能

## 添加资源界面修复和改进
- [x] 修复资源类型和选择框布局（真正放在同一行）
- [x] 添加搜索框支持关键字搜索
- [x] 改进分页组件为页码按钮式（1 2 3 4 5 ... 50）
- [x] 添加每页条数选择器（10条/页）

## 修复表单布局
- [x] 将资源类型和搜索框真正放在同一行（不换行）
- [x] 移除搜索框的Label，直接紧贴在选择框后面

## 修复Label布局
- [x] 将Label、选择框、搜索框都放在同一行（不换行）

## 资源多选功能
- [x] 将“选择”按钮改为复选框
- [x] 支持多选资源
- [x] 添加批量添加到权限组功能

## 资源数量显示优化
- [x] 修复添加资源后数量不更新的bug
- [x] 优化资源数显示为总数（如“资源: 6个”）
- [x] 添加鼠标悬浮提示显示详细分类（如“3个域名, 2个Nginx配置, 1个脚本”）

## 资源数显示和全选功能
- [x] 修复资源数显示格式（显示纯数字，不带“个”）
- [x] 添加表格标题行全选复选框
- [x] 实现全选/取消全选逻辑

## 多标签页管理功能
- [x] 创建标签页管理组件
- [x] 实现标签页打开、切换、关闭功能
- [x] 实现固定标签（首页不能关闭）
- [x] 集成到主布局中
- [x] 点击侧边栏菜单自动创建/切换标签

## 仪表盘链接修复
- [x] 修复多标签页点击仪表盘标签后404问题（使用wouter的setLocation替代window.history.pushState）

## 标签页增强功能
- [x] 限制标签页数量为10个
- [x] 实现标签状态持久化（localStorage）
- [x] 实现标签拖拽排序功能（使用dnd-kit）

## 标签页点击问题修复
- [x] 修复标签页无法点击切换的问题（将拖拽监听器只应用到标签文本）
- [x] 修复标签页无法关闭的问题（关闭按钮不受拖拽监听器影响）

## 标签切换和WebSocket问题修复
- [x] 修复标签无法切换的问题（使用onPointerDown代替on Click）
- [x] 修复用户列表WebSocket消息循环问题（禁用Mock WebSocket自动消息）

## 标签拖拽功能修复
- [x] 修复标签无法拖拽移动的问题（恢复onClick，让dnd-kit自动区分点击和拖拽）
- [x] 保持点击切换功能正常工作

## 标签点击切换修复
- [x] 使用activationConstraint区分点击和拖拽（设置8px阈值）
- [x] 确保点击切换和拖拽排序都能正常工作
